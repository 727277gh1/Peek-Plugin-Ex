# 调试指南

## 启用调试日志

如果扩展没有正常工作（例如右键菜单点击后没有弹出窗口），可以启用调试日志来诊断问题。

### 启用步骤

1. 点击浏览器工具栏中的扩展图标
2. 在设置页面中找到"启用调试日志"选项
3. 勾选该选项
4. 点击"保存设置"

### 查看日志

启用调试日志后，扩展会在浏览器控制台输出详细的运行信息。

#### 查看Background日志（后台服务）

1. 打开扩展管理页面：`chrome://extensions/`
2. 找到"AI 文本解释助手"扩展
3. 点击"详细信息"
4. 点击"检查视图"下的"service worker"链接
5. 这会打开后台脚本的控制台，可以看到以 `[AI助手-Background]` 开头的日志

#### 查看Content日志（网页内容脚本）

1. 在要使用扩展的网页上，按F12打开开发者工具
2. 切换到"Console"（控制台）标签
3. 选中文本并右键点击"使用 AI 解释"
4. 可以看到以 `[AI助手-Content]` 开头的日志

### 关键日志说明

#### Background日志
- `扩展已安装/更新` - 扩展初始化成功
- `上下文菜单已创建` - 右键菜单注册成功
- `上下文菜单被点击` - 用户点击了右键菜单
- `尝试ping内容脚本` - 检查内容脚本是否已加载
- `内容脚本不存在，开始注入...` - 动态注入内容脚本
- `注入JS文件` / `注入CSS文件` - 正在注入文件
- `脚本注入完成` - 注入成功
- `发送openSidebar消息到tab` - 向页面发送打开侧边栏的消息

#### Content日志
- `Content脚本初始化完成` - 内容脚本加载成功
- `收到消息: ping` - 收到ping检测请求
- `收到消息: openSidebar` - 收到打开侧边栏请求
- `openSidebar被调用` - 开始打开侧边栏
- `创建新的sidebar` - 创建侧边栏UI
- `sidebar已添加到DOM` - 侧边栏已添加到页面
- `sidebar已显示` - 侧边栏显示成功
- `explainText被调用` - 开始解释文本
- `获取到配置` - 读取配置成功
- `调用AI` - 开始调用AI接口

### 常见问题诊断

#### 问题1: 右键菜单不出现
查看Background日志是否有`上下文菜单已创建`，如果没有则扩展未正确加载。

#### 问题2: 点击菜单后没有反应
1. 查看Background日志是否有`上下文菜单被点击`
2. 查看是否有`注入脚本失败`的错误
3. 查看Content日志是否有`收到消息: openSidebar`

#### 问题3: 侧边栏不显示
1. 查看Content日志是否有`sidebar已添加到DOM`
2. 检查页面CSS是否与扩展样式冲突
3. 在开发者工具的Elements标签中搜索`ai-explain-sidebar`元素

#### 问题4: 无法调用AI
1. 查看Content日志是否有`配置错误：缺少API密钥或URL`
2. 检查是否正确配置了API密钥和接口地址
3. 在设置页面点击"测试连接"按钮验证配置

### 完成调试后

诊断问题并解决后，建议关闭调试日志以减少性能开销：
1. 打开扩展设置
2. 取消勾选"启用调试日志"
3. 点击"保存设置"
