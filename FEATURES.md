# 新功能说明

本文档介绍插件的最新功能特性。

## 🌊 流式输出

### 功能描述
实时显示 AI 的回复内容，无需等待完整响应，大大提升用户体验。

### 使用方法
1. 在插件设置中，勾选「启用流式输出」（默认开启）
2. 当 AI 回复时，内容会逐字逐句地实时显示
3. 可以立即开始阅读，无需等待完整回复

### 技术实现
- 使用 Server-Sent Events (SSE) 协议
- 支持标准的 OpenAI 流式响应格式
- 自动处理网络错误和中断

### 注意事项
- 流式输出需要 API 服务器支持 `stream: true` 参数
- 如果遇到兼容性问题，可以关闭流式输出使用普通模式

## 🧠 大模型思考链

### 功能描述
开启思考链功能后，AI 会展示其推理和思考过程，帮助理解答案的形成逻辑。

### 使用方法
1. 在插件设置中，勾选「开启思考链」
2. 适用于支持推理的模型（如 OpenAI o1 系列）
3. AI 会在回复中包含思考步骤

### 支持的模型
- **OpenAI o1**: 完整支持
- **OpenAI o1-mini**: 完整支持
- **GPT-4**: 部分支持（取决于提示词）
- **其他模型**: 根据模型文档确定

### 技术参数
- 添加 `reasoning_effort: 'high'` 参数到 API 请求
- 某些模型可能使用不同的参数名称

### 示例效果
```
思考过程：
1. 首先分析问题的核心要素
2. 考虑相关的背景知识
3. 推导出逻辑结论

最终答案：
基于以上分析...
```

## 📝 Markdown 渲染

### 功能描述
AI 的回复支持完整的 Markdown 格式，包括标题、列表、代码块、表格等。

### 支持的语法

#### 标题
```markdown
# 一级标题
## 二级标题
### 三级标题
```

#### 强调
```markdown
**粗体文本**
*斜体文本*
~~删除线~~
```

#### 列表
```markdown
- 无序列表项 1
- 无序列表项 2

1. 有序列表项 1
2. 有序列表项 2
```

#### 代码
```markdown
行内代码：`console.log('Hello')`

代码块：
​```javascript
function hello() {
  console.log('Hello World');
}
​```
```

#### 引用
```markdown
> 这是一段引用文本
```

#### 链接
```markdown
[链接文本](https://example.com)
```

#### 表格
```markdown
| 列1 | 列2 | 列3 |
| --- | --- | --- |
| 数据1 | 数据2 | 数据3 |
```

### 样式特性
- 代码块使用深色主题高亮
- 链接支持悬停效果
- 表格自动美化
- 引用块带有彩色左边框

## 📌 最小化功能

### 功能描述
当你需要浏览网页内容时，可以将聊天框最小化，避免遮挡页面。

### 使用方法

#### 最小化
1. 点击侧边栏标题栏右侧的「−」按钮
2. 侧边栏会缩小到屏幕右下角
3. 显示为一个小的浮动窗口

#### 恢复
1. 点击最小化的窗口
2. 侧边栏会恢复到完整大小

### 特性
- **平滑动画**：最小化和恢复都有流畅的过渡效果
- **不遮挡内容**：最小化后只占用很小的空间
- **保持状态**：对话历史不会丢失
- **随时恢复**：一键恢复到完整界面

### 最小化状态
```
┌─────────────────────┐
│ 🤖 AI 助手          │
└─────────────────────┘
```
- 位置：右下角
- 宽度：280px
- 高度：60px
- 可点击恢复

## 🎨 用户界面增强

### 按钮布局
- 标题栏右侧有两个按钮：
  - **最小化（−）**: 最小化到右下角
  - **关闭（✕）**: 完全关闭侧边栏

### 视觉效果
- 按钮悬停时有背景高亮
- 关闭按钮悬停时会旋转
- 所有交互都有平滑过渡动画

## 🔧 配置选项

在插件设置页面新增：

### 启用流式输出
- **类型**: 复选框
- **默认值**: 开启
- **说明**: 实时显示 AI 回复（推荐）

### 开启思考链
- **类型**: 复选框
- **默认值**: 关闭
- **说明**: 让 AI 展示推理过程（仅支持特定模型如 o1）

## 💡 使用建议

### 流式输出
✅ **推荐场景**：
- 长文本解释
- 需要快速查看结果
- 网络连接稳定

❌ **不推荐场景**：
- API 不支持流式
- 网络不稳定
- 需要完整响应后再处理

### 思考链
✅ **推荐场景**：
- 复杂问题分析
- 学习推理过程
- 需要详细解释

❌ **不推荐场景**：
- 简单问题
- 追求快速响应
- 节省 token 成本

### 最小化
✅ **推荐使用**：
- 需要同时查看网页和对话
- 暂时不需要输入
- 保持 AI 助手在后台

❌ **不需要**：
- 不再使用时直接关闭
- 需要全屏专注于对话

## 🐛 故障排查

### 流式输出不工作
1. 检查 API 是否支持流式响应
2. 尝试关闭流式输出使用普通模式
3. 检查网络连接是否稳定

### 思考链不显示
1. 确认使用的模型支持推理功能
2. 检查 API 文档是否使用不同的参数名
3. 尝试使用支持的模型（如 o1）

### Markdown 渲染异常
1. 检查内容是否符合标准 Markdown 语法
2. 特殊字符可能需要转义
3. 刷新页面重试

### 最小化后无法恢复
1. 点击最小化窗口的任何位置
2. 如果无响应，关闭并重新打开侧边栏
3. 刷新页面

## 📊 性能优化

### 流式输出
- 减少首次响应时间
- 提升用户体验
- 降低感知延迟

### Markdown 渲染
- 轻量级解析器，不依赖外部库
- 仅在 AI 回复时渲染
- 用户消息保持纯文本

### 最小化
- CSS 动画，GPU 加速
- 不影响页面性能
- 保持低内存占用

## 🔄 更新历史

### v1.1.0 (当前版本)
- ✨ 新增流式输出支持
- ✨ 新增大模型思考链功能
- ✨ 新增 Markdown 渲染
- ✨ 新增最小化功能
- 🎨 优化用户界面
- 🐛 修复已知问题

### v1.0.0
- 🎉 初始版本发布
- ✅ 基础对话功能
- ✅ 右键菜单集成
- ✅ 配置管理
